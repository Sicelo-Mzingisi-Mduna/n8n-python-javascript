[supervisord]
nodaemon=true
user=root
logfile=/dev/stdout
logfile_maxbytes=0

# -------------------------------
# Main n8n server
# -------------------------------
[program:n8n-main]
command=n8n start
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr
redirect_stderr=true
environment=
    NODE_ENV="production",
    N8N_RUNNERS_ENABLED="true",
    N8N_RUNNERS_MODE="external",
    N8N_RUNNERS_CONFIG_PATH="/etc/secrets/n8n-task-runners.json"

# -------------------------------
# Python task runner
# -------------------------------
[program:n8n-python-runner]
command=/usr/local/bin/task-runner-launcher --config /etc/secrets/n8n-task-runners.json
autostart=true
autorestart=true
startsecs=5
stdout_logfile=/dev/stdout
stderr_logfile=/dev/stderr
redirect_stderr=true
environment=
    N8N_RUNNERS_AUTH_TOKEN="%(ENV_N8N_RUNNERS_AUTH_TOKEN)s"
